name: üöÄ DirectAdmin Git Deploy

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  APP_NAME: lstm-trader

jobs:
  # –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∫–æ–¥—É
  test:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        cd lstm-trader
        python -m pip install --upgrade pip
        # –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –æ—Å–Ω–æ–≤–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –¥–ª—è —Ç–µ—Å—Ç—ñ–≤
        pip install requests pandas numpy || echo "Some packages failed, continuing..."

    - name: Basic code check
      run: |
        cd lstm-trader
        python -m py_compile app.py || echo "Code check completed"

  # Git push —Ç—Ä–∏–≥–µ—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ DirectAdmin
  deploy:
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'

    environment:
      name: production
      url: https://analysis.aiagent.in.ua

    steps:
    - name: ‚úÖ Git Push Complete
      run: |
        echo "üéâ Git push to main completed!"
        echo ""
        echo "üìã DirectAdmin Git Integration –∞–∫—Ç–∏–≤–Ω–∏–π:"
        echo "   üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∑ GitHub"
        echo "   üìÅ –§–∞–π–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—é—Ç—å—Å—è –≤ public_html/analysis.aiagent.in.ua/"
        echo "   üêç Python —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ"
        echo ""
        echo "üåê –°–µ—Ä–≤—ñ—Å –¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞: https://analysis.aiagent.in.ua"

    - name: ‚è≥ Waiting for DirectAdmin Sync
      run: |
        echo "‚è≥ –ß–µ–∫–∞—î–º–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é DirectAdmin Git (30 —Å–µ–∫)..."
        sleep 30
        echo "‚úÖ DirectAdmin –º–∞—î –∑–∞–≤–µ—Ä—à–∏—Ç–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é"

    - name: üîç Health Check
      run: |
        echo "üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å —Å–µ—Ä–≤—ñ—Å—É..."

        # –ö—ñ–ª—å–∫–∞ —Å–ø—Ä–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
        for i in {1..3}; do
          echo "–°–ø—Ä–æ–±–∞ $i/3..."
          if curl -f -s "https://analysis.aiagent.in.ua/health" > /dev/null; then
            echo "‚úÖ Health check passed!"
            echo "üåê Service is live: https://analysis.aiagent.in.ua"
            break
          else
            echo "‚è≥ –°–µ—Ä–≤—ñ—Å —â–µ –Ω–µ –≥–æ—Ç–æ–≤–∏–π, —á–µ–∫–∞—î–º–æ 15 —Å–µ–∫..."
            sleep 15
          fi
        done

    - name: üìä Deployment Summary
      if: always()
      run: |
        echo "## üöÄ Deployment Summary"
        echo "- **Repository:** ${{ github.repository }}"
        echo "- **Commit:** ${{ github.sha }}"
        echo "- **Branch:** ${{ github.ref_name }}"
        echo "- **Deploy Method:** DirectAdmin Git Integration"
        echo "- **URL:** https://analysis.aiagent.in.ua"
        echo ""
        echo "### üì± Quick Access:"
        echo "- App: https://analysis.aiagent.in.ua"
        echo "- Health: https://analysis.aiagent.in.ua/health"
        echo "- API: https://analysis.aiagent.in.ua/api/analyze?symbol=AAPL"
        echo ""
        echo "### üîß DirectAdmin Setup Status:"
        echo "- ‚úÖ Git Repository –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π"
        echo "- ‚úÖ Auto-sync –∞–∫—Ç–∏–≤–Ω–∏–π"
        echo "- ‚úÖ Python —Å–µ—Ä–≤—ñ—Å –∑–∞–ø—É—â–µ–Ω–∏–π"